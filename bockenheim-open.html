<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Bockenheim Open 2025</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      --primary-color:#0d6b33; --secondary-color:#f5f5f5; --accent-color:#d4af37;
      --text-color:#333; --card-bg:#fff; --danger-color:#c62828;
      --highlight:#fffbef; --highlight-border:#d4af37;
      --over:#c62828; --under:#2e7d32; --on:#111;
    }
    body{font-family:'Montserrat',sans-serif;margin:0;background:var(--secondary-color);color:var(--text-color);line-height:1.6}
    @keyframes fadeInDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
    .header{background:var(--primary-color);
      background-image:
        linear-gradient(135deg,rgba(255,255,255,.05) 25%,transparent 25%),
        linear-gradient(225deg,rgba(255,255,255,.05) 25%,transparent 25%),
        linear-gradient(45deg,rgba(255,255,255,.05) 25%,transparent 25%),
        linear-gradient(315deg,rgba(255,255,255,.05) 25%,var(--primary-color) 25%);
      background-position:10px 0,10px 0,0 0,0 0;background-size:20px 20px;background-repeat:repeat;
      color:#fff;text-align:center;padding:2.5rem 1rem 3.5rem;clip-path:polygon(0 0,100% 0,100% 85%,50% 100%,0 85%);margin-bottom:-3rem;position:relative;z-index:10}
    .header h1{margin:0;font-size:clamp(2.2rem,7vw,3.6rem);font-weight:900;text-transform:uppercase;letter-spacing:4px;text-shadow:3px 3px 10px rgba(0,0,0,.5);animation:fadeInDown 1s ease-out}
    .header p{margin:.5rem 0 0;font-size:clamp(.95rem,3.5vw,1.1rem);opacity:.9;font-weight:700}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .card{background:var(--card-bg);border-radius:15px;padding:22px;margin-bottom:22px;box-shadow:0 10px 20px rgba(0,0,0,.08);border-left:5px solid var(--primary-color)}
    h2{font-size:1.6rem;font-weight:700;color:var(--primary-color);border-bottom:3px solid var(--accent-color);padding-bottom:8px;margin-top:0}
    #map{height:460px;width:100%;border-radius:10px}

    .stop{padding:14px;margin-bottom:16px;border-radius:10px;background:#fafafa;border:1px solid #eee}
    .stop-info{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
    .stop h3{margin:0;font-size:1.1rem}
    .drink{font-style:italic;color:#555}
    .par{font-weight:900;font-size:2.2rem;color:var(--primary-color);line-height:1}
    .par span{font-size:.9rem;font-weight:400;display:block;color:#777}
    .stop.active{background:var(--highlight);border-left:5px solid var(--highlight-border);transform:scale(1.02);transition:all .2s ease}

    #current-challenge-card{display:none;text-align:center;border-color:var(--highlight-border);background:var(--highlight)}
    #current-challenge-card h2{font-size:1.3rem}
    #current-challenge-card .par{font-size:2.6rem;margin-top:.6rem}

    ul.rules-list{list-style:none;padding:0;margin:0}
    ul.rules-list li{padding:8px 0;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
    ul.rules-list li:last-child{border-bottom:none}
    .penalty{font-weight:700}
    .penalty.positive{color:#c62828} .penalty.negative{color:#2e7d32}

    table{width:100%;border-collapse:collapse;margin-top:12px;font-size:.9rem}
    th,td{border:1px solid #ddd;padding:8px;text-align:center}
    th{background:var(--primary-color);color:#fff;font-weight:700}
    td.team-name{text-align:left;font-weight:700}
    td.total{font-weight:900;background:#e8f5e9}

    /* kompakter Countdown */
    .countdown{text-align:center}
    .countdown-container{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:8px}
    .countdown-item{background:#fff;border:1px solid #eee;border-radius:8px;min-width:66px;padding:6px 8px}
    .countdown-number{font-size:1.6rem;font-weight:800;color:var(--primary-color);line-height:1}
    .countdown-label{font-size:.75rem;color:#777;margin-top:2px}

    .timer{text-align:center}
    .timer-display{font-size:3rem;font-weight:900;color:var(--primary-color);margin:8px 0}
    .timer-controls button{background:var(--primary-color);color:#fff;border:none;padding:10px 18px;font-size:.95rem;border-radius:8px;cursor:pointer;margin:4px;transition:background-color .3s,transform .2s}
    .timer-controls button:hover{background:#0a5227;transform:translateY(-2px)}
    .timer-controls button:disabled{background:#999;cursor:not-allowed}

    .admin-panel{background:var(--text-color);color:#fff;border-radius:15px;padding:22px;margin-top:24px}
    .admin-panel h2,.admin-panel h3{color:#fff;border-color:var(--accent-color)}
    .admin-panel input,.admin-panel select,.admin-panel button{width:100%;padding:10px;margin-bottom:10px;border-radius:6px;border:none;box-sizing:border-box}
    .admin-panel button{background:var(--accent-color);color:var(--text-color);font-weight:800;cursor:pointer;transition:transform .15s ease}
    .admin-panel button:hover{transform:scale(1.02)}
    #admin-content{display:none}
    .danger-button{background:var(--danger-color)!important;color:#fff}
    .confirm-button{background:#ff3d00!important;color:#fff}

    /* Farben für +/-/0 im Leaderboard */
    .rel-pos{color:var(--over);font-weight:700}
    .rel-neg{color:var(--under);font-weight:700}
    .rel-zero{color:var(--on);font-weight:700}
  </style>
</head>
<body>
<header class="header">
  <h1>Bockenheim Open</h1>
  <p>Hostet by BAC / Basalt WG</p>
</header>

<main class="container">
  <!-- Countdown -->
  <section class="card countdown">
    <h2>Tour Start</h2>
    <div id="countdown-container" class="countdown-container">
      <div class="countdown-item"><div id="days" class="countdown-number">0</div><div class="countdown-label">Tage</div></div>
      <div class="countdown-item"><div id="hours" class="countdown-number">0</div><div class="countdown-label">Std</div></div>
      <div class="countdown-item"><div id="minutes" class="countdown-number">0</div><div class="countdown-label">Min</div></div>
      <div class="countdown-item"><div id="seconds" class="countdown-number">0</div><div class="countdown-label">Sek</div></div>
    </div>
    <p id="countdown-message" style="font-weight:700;margin-top:8px;"></p>
  </section>

  <!-- Aktuelle Challenge -->
  <section class="card" id="current-challenge-card">
    <h2>AKTUELLE CHALLENGE</h2>
    <div id="current-challenge-content">
      <p>Der Admin hat die Tour noch nicht gestartet.</p>
    </div>
  </section>

  <!-- Karte -->
  <section class="card">
    <h2>Die Route & Karte</h2>
    <div id="map"></div>
  </section>

  <!-- Tour-Plan -->
  <section class="card">
    <h2>Die 9 Löcher (Tour-Plan)</h2>
    <div id="stops-list"></div>
  </section>

  <!-- Leaderboard -->
  <section class="card">
    <h2>Live Leaderboard</h2>
    <div style="overflow-x:auto">
      <table id="leaderboard">
        <thead>
          <tr>
            <th>Team</th>
            <th>Strafen</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Regeln -->
  <section class="card">
    <h2>Regelwerk</h2>
    <ul class="rules-list">
      <li>Getränk verschüttet <span class="penalty positive">+2</span></li>
      <li>Hole-in-One (Exen) <span class="penalty negative">-2</span></li>
      <li>Loch nicht beendet <span class="penalty positive">+3</span></li>
      <li>Nicht mit dem Partner getrunken (1x Joker) <span class="penalty positive">+3</span></li>
      <li>Party-Hut abgenommen <span class="penalty positive">+1</span></li>
    </ul>
  </section>

  <!-- Timer -->
  <section class="card timer">
    <h2>10-Sekunden Ex-Counter</h2>
    <div id="timer-display" class="timer-display">10.0</div>
    <div class="timer-controls">
      <button id="timer-start">Start</button>
      <button id="timer-reset">Reset</button>
    </div>
  </section>

  <!-- Admin -->
  <section class="admin-panel">
    <h2>Admin-Steuerung</h2>

    <div id="login-section">
      <p>Passwort eingeben, um Scores zu verwalten.</p>
      <input type="password" id="admin-password" placeholder="Admin-Passwort" />
      <button onclick="unlockAdmin()">Freischalten</button>
    </div>

    <div id="admin-content">
      <h3>Scores pro Loch</h3>
      <label for="score-team-select">Team auswählen:</label>
      <select id="score-team-select"></select>

      <label for="hole-select">Loch auswählen:</label>
      <select id="hole-select"></select>

      <label for="score-input">Benötigte Schlücke (Gesamt):</label>
      <input type="number" id="score-input" placeholder="Anzahl" min="0" />
      <button onclick="updateScore()">Score eintragen</button>

      <hr style="margin:16px 0;border-color:#555">

      <h3>Strafen & Boni</h3>
      <label for="penalty-team-select">Team auswählen:</label>
      <select id="penalty-team-select"></select>
      <label for="penalty-select">Regel auswählen:</label>
      <select id="penalty-select"></select>
      <button onclick="applyPenalty()">Strafe/Bonus anwenden</button>

      <hr style="margin:16px 0;border-color:#555">

      <h3>Tour-Steuerung</h3>
      <label for="current-stop-select">Aktuellen Stopp festlegen:</label>
      <select id="current-stop-select"></select>
      <button onclick="setCurrentStop()">Als aktuellen Stopp setzen</button>

      <hr style="margin:16px 0;border-color:#555">

      <h3>Gefahrenzone</h3>
      <button id="reset-button" class="danger-button" onclick="requestFullReset()">ALLES ZURÜCKSETZEN</button>
      <button id="cancel-reset-button" style="display:none;background:#555;color:#fff" onclick="cancelReset()">Abbrechen</button>
    </div>
  </section>
</main>

<script>
  const tourConfig = {
    stops: [
      { name:"Start: Basaltstraße 39", lat:50.1259278, lon:8.6441328, drink:"Long-Drink", par:4, address:"Basaltstraße 39" },
      { name:"Dalli Dalli Pilsstübchen", lat:50.1256647, lon:8.6436847, drink:"Bier/Appler", par:3, address:"Grempstraße 4" },
      { name:"Lüsterweibchen", lat:50.1241143, lon:8.6414999, drink:"Wein", par:3, address:"Große Seestraße 49a" },
      { name:"Kiosk am Platz", lat:50.1244439, lon:8.6434939, drink:"Shot", par:1, address:"Kurfürstenpl. 36" },
      { name:"Casa Blanca", lat:50.1198891, lon:8.6450849, drink:"Cocktail / Longdrink", par:4, address:"Adalbertstraße 34" },
      { name:"Zum Tannenbaum", lat:50.1189258, lon:8.6463081, drink:"Appler", par:3, address:"Adalbertstraße 53" },
      { name:"Khan Kiosk", lat:50.1198055, lon:8.6487065, drink:"Bier/Appler", par:3, address:"Leipziger Str. 2" },
      { name:"Extrablatt", lat:50.1198957, lon:8.6504733, drink:"Shot", par:1, address:"Bockenheimer Warte" },
      { name:"Doctor Flotte", lat:50.1204769, lon:8.65017, drink:"Bier / Appler / Wein", par:3, address:"Leipziger Str. 20" }
    ],
    teams:["Team Alpha","Team Bravo","Team Charlie","Team Delta"], /* Echo entfernt */
    adminPassword:"bockenheim",
    rules:[
      { text:"Getränk verschüttet", value:2 },
      { text:"Hole-in-One (Exen)", value:-2 },
      { text:"Loch nicht beendet", value:3 },
      { text:"Partner-Regel missachtet", value:3 },
      { text:"Party-Hut abgenommen", value:1 }
    ]
  };
  window.scores={}; window.currentStopIndex=-1;
  document.addEventListener('DOMContentLoaded',()=>{initCountdown();initExCounter();initMap();initStopsList();initLeaderboard();initAdminPanel();});
  /* … (hier bleibt der ganze JS-Code wie in deiner letzten Version, nur tourConfig.teams wurde reduziert) … */
</script>

<!-- Firebase Block bleibt unverändert, aber TEAMS jetzt = 4 -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  const firebaseConfig={/* deine config unverändert */};
  const app=initializeApp(firebaseConfig); const db=getFirestore(app); const auth=getAuth(app);

  const EVENT_ID="bockenheim-open-2025";
  const HOLES=window.tourConfig?.stops?.length??9;
  const TEAMS=(window.tourConfig?.teams??[]).slice(); // jetzt 4

  /* … restlicher Firebase-Sync Code wie zuvor … */
</script>
</body>
</html>
